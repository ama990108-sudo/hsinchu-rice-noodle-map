<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>æ–°ç«¹ç±³ç²‰åœ°åœ– | Hsinchu Rice Noodle Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"PingFang TC","Noto Sans TC","Microsoft JhengHei",sans-serif;background:#faf7f2;color:#222}
    header{background:#c62828;color:#fff;padding:14px 18px;display:flex;align-items:center;gap:12px}
    header h1{margin:0;font-size:1.2rem}
    header .spacer{flex:1}
    header button{background:#fff;color:#c62828;border:none;border-radius:8px;padding:6px 10px;font-weight:700;cursor:pointer}
    #map{height:62vh}
    main{max-width:1000px;margin:auto;padding:14px}
    .panel{background:#fff;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.06);padding:14px;margin-bottom:14px}
    .list{display:grid;grid-template-columns:1fr;gap:10px}
    @media(min-width:760px){.list{grid-template-columns:1fr 1fr}}
    .item{border-left:6px solid #c62828;border-radius:10px;padding:10px}
    .item h3{margin:0 0 6px}
    .links a{margin-right:10px;color:#c62828;font-weight:700;text-decoration:none}
    .stars span{font-size:1.3rem;cursor:pointer;color:#ccc}
    .stars span.active{color:#f6b400}
    textarea{width:100%;min-height:70px;border-radius:8px;border:1px solid #ddd;padding:8px}
    footer{color:#666;font-size:.9rem;padding:10px 14px}
  </style>
</head>
<body>
<header>
  <h1 id="title">æ–°ç«¹ç±³ç²‰åœ°åœ–</h1>
  <div class="spacer"></div>
  <button id="langBtn">EN</button>
</header>

<div id="map"></div>
<section id="ratings">
  <h2>â­ ç±³ç²‰åº—è©•åˆ†ï½œRice Noodle Ratings</h2>

  <div class="shop-rating">
    <h3>åŸéšå»Ÿ é˜¿åŸç±³ç²‰</h3>
    <p>
      å¹³å‡è©•åˆ†ï¼š<span id="avg-acheng">è¼‰å…¥ä¸­...</span> â­
      ï¼ˆ<span id="count-acheng">0</span> äººè©•åˆ†ï¼‰
    </p>
    <a href="ã€è²¼ä½ çš„Googleè¡¨å–®é€£çµã€‘" target="_blank">
      æˆ‘è¦è©•åˆ† / Rate this shop
    </a>
  </div>
</section>
<main>
  <section class="panel">
    <h2 id="routeTitle">ğŸ“ è·¯ç·šèªªæ˜</h2>
    <p id="routeDesc">ä»¥æ–°ç«¹ç«è»Šç«™èˆ‡åŸéšå»Ÿç‚ºæ ¸å¿ƒï¼Œæ­¥è¡Œå¯é”çš„ç¶“å…¸ç±³ç²‰åº—ã€‚é»æ“Šåœ°åœ–ç´…é»å¯æŸ¥çœ‹ä¸¦å‰å¾€ Google åœ°åœ–ã€‚</p>
    <p class="links">
      <a href="https://www.google.com/maps/search/?api=1&query=æ–°ç«¹ç«è»Šç«™" target="_blank" rel="noopener">æ–°ç«¹ç«è»Šç«™</a>
      <a href="https://www.google.com/maps/search/?api=1&query=æ–°ç«¹åŸéšå»Ÿ" target="_blank" rel="noopener">æ–°ç«¹åŸéšå»Ÿ</a>
    </p>
  </section>

  <section class="panel">
    <h2 id="listTitle">ğŸœ åº—å®¶æ¸…å–®ï¼ˆå¯è©•åˆ†ï¼‰</h2>
    <div class="list" id="shopList"></div>
  </section>

  <section class="panel">
    <h2 id="fbTitle">ğŸ’¬ æ„è¦‹å›é¥‹</h2>
    <p id="fbDesc">æ­¤å›é¥‹åƒ…å„²å­˜åœ¨ä½ çš„ç€è¦½å™¨ï¼ˆlocalï¼‰ã€‚</p>
    <textarea id="feedback" placeholder="å¯«ä¸‹ä½ å°é€™å¼µåœ°åœ–çš„å»ºè­°â€¦"></textarea>
  </section>
</main>

<footer>
  <p id="foot">æç¤ºï¼šè©•åˆ†èˆ‡å›é¥‹ä½¿ç”¨ç€è¦½å™¨ localStorageï¼Œé‡æ–°æ•´ç†ä»æœƒä¿ç•™ã€‚</p>
</footer>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  const shops = [
  // ===== Hsinchu Station =====
  {
    id:"dongmen",
    station:"Hsinchu",
    zh:{name:"æ±é–€ç±³ç²‰æ”¤",desc:"æ±é–€å¸‚å ´å…§ï¼Œåœ¨åœ°ä»£è¡¨æ€§ç±³ç²‰æ¹¯"},
    en:{name:"Dongmen Market Rice Noodle Soup",desc:"Iconic local shop inside Dongmen Market"},
    lat:24.8046, lng:120.9715,
    g:"https://www.google.com/maps/search/?api=1&query=æ±é–€ç±³ç²‰æ”¤ æ–°ç«¹"
  },
  {
    id:"acheng",
    station:"Hsinchu",
    zh:{name:"é˜¿åŸç±³ç²‰",desc:"åŸéšå»Ÿå‘¨é‚Šï¼Œæ¹¯é ­æ¸…ç”œ"},
    en:{name:"A-Cheng Rice Noodles",desc:"Near Chenghuang Temple, light broth"},
    lat:24.8039, lng:120.9659,
    g:"https://www.google.com/maps/search/?api=1&query=é˜¿åŸç±³ç²‰ æ–°ç«¹"
  },

  // ===== North Hsinchu =====
  {
    id:"datong",
    station:"North Hsinchu",
    zh:{name:"å¤§åŒç±³ç²‰æ¹¯",desc:"åŒ—æ–°ç«¹è€åº—ï¼Œå¤æ—©å‘³"},
    en:{name:"Datong Rice Noodle Soup",desc:"Old-style noodles near North Hsinchu Station"},
    lat:24.8134, lng:120.9721,
    g:"https://www.google.com/maps/search/?api=1&query=å¤§åŒç±³ç²‰æ¹¯ æ–°ç«¹"
  },

  // ===== Xiangshan =====
  {
  id:"dingpu",
  station:"Xiangshan",
  zh:{name:"é ‚åŸ”ç±³ç²‰æ¹¯",desc:"é¦™å±±é ‚åŸ”åœ°å€ï¼Œåœ¨åœ°å‚³çµ±ç±³ç²‰æ¹¯"},
  en:{name:"Dingpu Rice Noodle Soup",desc:"Traditional local noodles in Dingpu area"},
  lat:24.76091, lng:120.92934,
  g:"https://www.google.com/maps/place/é ‚åŸ”ç±³ç²‰æ¹¯"
  },

  // ===== Zhubei =====
  {
    id:"zhubei-old",
    station:"Zhubei",
    zh:{name:"ç«¹åŒ—è€åº—ç±³ç²‰æ¹¯",desc:"ç«¹åŒ—è»Šç«™æ­¥è¡Œå¯é”"},
    en:{name:"Old Zhubei Rice Noodle Soup",desc:"Classic shop near Zhubei Station"},
    lat:24.8384, lng:121.0090,
    g:"https://www.google.com/maps/search/?api=1&query=ç«¹åŒ—ç±³ç²‰æ¹¯"
  },

  // ===== Xinfeng =====
  {
    id:"xinfeng",
    station:"Xinfeng",
    zh:{name:"æ–°è±è€è¡—ç±³ç²‰æ¹¯",desc:"æ–°è±åœ¨åœ°å‚³çµ±å£å‘³"},
    en:{name:"Xinfeng Old Street Rice Noodle Soup",desc:"Traditional noodles near Xinfeng Station"},
    lat:24.9042, lng:120.9984,
    g:"https://www.google.com/maps/search/?api=1&query=æ–°è±ç±³ç²‰æ¹¯"
  }
];

  let lang = "zh";
  const map = L.map('map').setView([24.8039,120.9698], 15);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19, attribution: '&copy; OpenStreetMap'
  }).addTo(map);

  const redIcon = new L.Icon({
    iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
    iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41]
  });

  


  const markers = {};

function renderMarkers(){
  Object.values(markers).forEach(m => map.removeLayer(m));

  shops.forEach(s => {
    markers[s.id] = m;
  });
}

  function starUI(id){
    const val = Number(localStorage.getItem('rate_'+id)||0);
    let html = '<div class="stars" data-id="'+id+'">';
    for(let i=1;i<=5;i++){
      html += '<span class="'+(i<=val?'active':'')+'">â˜…</span>';
    }
    html += '</div>';
    return html;
  }

  function renderList(){
    const el = document.getElementById('shopList');
    el.innerHTML = shops.map(s=>`
      <div class="item">
        <h3>${lang==='zh'?s.zh.name:s.en.name}</h3>
        <p>${lang==='zh'?s.zh.desc:s.en.desc}</p>
        ${starUI(s.id)}
        <div class="links"><a href="${s.g}" target="_blank">Google Maps</a></div>
      </div>
    `).join('');
    document.querySelectorAll('.stars').forEach(st=>{
      st.querySelectorAll('span').forEach((sp,i)=>{
        sp.onclick=()=>{
          localStorage.setItem('rate_'+st.dataset.id, i+1);
          renderList();
        }
      })
    })
  }

  function applyLang(){
    document.getElementById('title').textContent = lang==='zh'?'æ–°ç«¹ç±³ç²‰åœ°åœ–':'Hsinchu Rice Noodle Map';
    document.getElementById('routeTitle').textContent = lang==='zh'?'ğŸ“ è·¯ç·šèªªæ˜':'ğŸ“ Route';
    document.getElementById('routeDesc').textContent = lang==='zh'
      ?'ä»¥æ–°ç«¹ç«è»Šç«™èˆ‡åŸéšå»Ÿç‚ºæ ¸å¿ƒï¼Œæ­¥è¡Œå¯é”çš„ç¶“å…¸ç±³ç²‰åº—ã€‚é»æ“Šåœ°åœ–ç´…é»å¯æŸ¥çœ‹ä¸¦å‰å¾€ Google åœ°åœ–ã€‚'
      :'Walkable classic rice noodle shops around Hsinchu Train Station and Chenghuang Temple. Click red markers for Google Maps.';
    document.getElementById('listTitle').textContent = lang==='zh'?'ğŸœ åº—å®¶æ¸…å–®ï¼ˆå¯è©•åˆ†ï¼‰':'ğŸœ Shop List (Rate it)';
    document.getElementById('fbTitle').textContent = lang==='zh'?'ğŸ’¬ æ„è¦‹å›é¥‹':'ğŸ’¬ Feedback';
    document.getElementById('fbDesc').textContent = lang==='zh'?'æ­¤å›é¥‹åƒ…å„²å­˜åœ¨ä½ çš„ç€è¦½å™¨ï¼ˆlocalï¼‰ã€‚':'Feedback is stored locally in your browser.';
    document.getElementById('foot').textContent = lang==='zh'
      ?'æç¤ºï¼šè©•åˆ†èˆ‡å›é¥‹ä½¿ç”¨ç€è¦½å™¨ localStorageï¼Œé‡æ–°æ•´ç†ä»æœƒä¿ç•™ã€‚'
      :'Tip: Ratings and feedback are saved locally via localStorage.';
    document.getElementById('langBtn').textContent = lang==='zh'?'EN':'ä¸­æ–‡';
    renderMarkers(); renderList();
  }

  document.getElementById('langBtn').onclick=()=>{ lang = (lang==='zh'?'en':'zh'); applyLang(); };
  const fb = document.getElementById('feedback');
  fb.value = localStorage.getItem('feedback')||'';
  fb.oninput=()=>localStorage.setItem('feedback', fb.value);

  applyLang();
</script>
<script>
fetch("ã€è²¼ä½ çš„Google Sheets CSV é€£çµã€‘")
  .then(res => res.text())
  .then(text => {
    const rows = text.split("\n");
    const avg = rows[1].split(",")[0];
    const count = rows[1].split(",")[1];

    document.getElementById("avg-acheng").innerText =
      Number(avg).toFixed(1);

    document.getElementById("count-acheng").innerText = count;
  });
</script>
</body>
</html>
