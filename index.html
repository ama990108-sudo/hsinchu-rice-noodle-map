<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>æ–°ç«¹ç±³ç²‰åœ°åœ– | Hsinchu Rice Noodle Map</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
:root{
  --red:#c62828;
  --bg:#faf7f2;
  --card:#ffffff;
  --star:#f6b400;
}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"PingFang TC","Noto Sans TC","Microsoft JhengHei",sans-serif;
  background:var(--bg);
}
header{
  background:var(--red);
  color:#fff;
  padding:14px 18px;
  display:flex;
  align-items:center;
}
header h1{margin:0;font-size:1.2rem}
#map{height:60vh}

main{
  max-width:1100px;
  margin:auto;
  padding:16px;
}
.panel{
  background:#fff;
  border-radius:16px;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
  padding:16px;
  margin-bottom:16px;
}
.list{
  display:grid;
  grid-template-columns:1fr;
  gap:12px;
}
@media(min-width:760px){
  .list{grid-template-columns:1fr 1fr}
}
.item{
  border-left:6px solid var(--red);
  border-radius:12px;
  padding:12px;
}
.stars{color:var(--star);font-weight:700}
a{color:var(--red);font-weight:700;text-decoration:none}
.footer{text-align:center;font-size:.85rem;color:#666;margin-bottom:20px}
</style>
</head>

<body>

<header>
  <h1>æ–°ç«¹ç±³ç²‰åœ°åœ–</h1>
</header>

<div id="map"></div>

<main>

<section class="panel">
<h2>ğŸœ ç±³ç²‰åº—è©•åˆ†ï¼ˆå³æ™‚ï¼‰</h2>
<div class="list" id="shopList"></div>
</section>

<section class="panel">
<h2>ğŸ“ æˆ‘è¦è©•åˆ†</h2>
<a href="ã€åœ¨é€™è£¡è²¼ä½ çš„ Google è¡¨å–®é€£çµã€‘" target="_blank">
ğŸ‘‰ é»æˆ‘å¡«å¯« Google è¡¨å–®
</a>
</section>

</main>

<div class="footer">
Â© Hsinchu Rice Noodle Map
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ===== åº—å®¶è³‡æ–™ ===== */
const shops=[
{id:"dongmen",name:"æ±é–€ç±³ç²‰æ”¤",lat:24.8046,lng:120.9715},
{id:"acheng",name:"é˜¿åŸç±³ç²‰",lat:24.8039,lng:120.9659},
{id:"datong",name:"å¤§åŒç±³ç²‰æ¹¯",lat:24.8134,lng:120.9721},
{id:"linji",name:"æ—è¨˜ç±³ç²‰æ¹¯",lat:24.8139,lng:120.9866},
{id:"xiangshan",name:"é¦™å±±è€åº—ç±³ç²‰æ¹¯",lat:24.7646,lng:120.9104},
{id:"zhubei1",name:"æ­£å®—ç«¹åŒ—ç±³ç²‰æ¹¯",lat:24.8388,lng:121.0094},
{id:"zhubei2",name:"åŠ‰å®¶ç±³ç²‰æ¹¯",lat:24.8374,lng:121.0112}
];

/* ===== åœ°åœ– ===== */
const map = L.map("map").setView([24.805,120.97],15);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{
  maxZoom:19,
  detectRetina:true
}).addTo(map);

/* ===== Marker ===== */
shops.forEach(s=>{
  const m=L.marker([s.lat,s.lng]).addTo(map);

  m.bindPopup(`
    <b>${s.name}</b><br>
    <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(s.name)}" target="_blank">
      Google Maps
    </a>
  `);

  m.on("click",()=>{
    map.flyTo([s.lat,s.lng],17,{animate:true});
    m.openPopup();
  });
});

/* ===== å¾ Google Sheets è®€å–è©•åˆ† ===== */
fetch("ã€åœ¨é€™è£¡è²¼ Google Sheets çš„ CSV é€£çµã€‘")
.then(r=>r.text())
.then(text=>{
  const rows=text.trim().split("\n").slice(1);
  const stat={};

  rows.forEach(r=>{
    const [id,star]=r.split(",");
    if(!stat[id])stat[id]={sum:0,count:0};
    stat[id].sum+=Number(star);
    stat[id].count++;
  });

  document.getElementById("shopList").innerHTML=shops.map(s=>{
    const d=stat[s.id];
    const avg=d?(d.sum/d.count).toFixed(1):"â€”";
    const cnt=d?d.count:0;
    return `
      <div class="item">
        <b>${s.name}</b><br>
        <span class="stars">â­ ${avg}</span>ï¼ˆ${cnt} äººï¼‰
      </div>
    `;
  }).join("");
});
</script>

</body>
</html>