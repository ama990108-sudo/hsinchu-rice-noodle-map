<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>æ–°ç«¹ç±³ç²‰åœ°åœ– | Hsinchu Rice Noodle Map</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"PingFang TC","Noto Sans TC","Microsoft JhengHei",sans-serif;background:#faf7f2;color:#222}
header{background:#c62828;color:#fff;padding:14px 18px;display:flex;align-items:center}
header h1{margin:0;font-size:1.2rem}
header .spacer{flex:1}
header button{background:#fff;color:#c62828;border:none;border-radius:8px;padding:6px 10px;font-weight:700;cursor:pointer}
#map{height:62vh}
main{max-width:1000px;margin:auto;padding:14px}
.panel{background:#fff;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.06);padding:14px;margin-bottom:14px}
.list{display:grid;grid-template-columns:1fr;gap:10px}
@media(min-width:760px){.list{grid-template-columns:1fr 1fr}}
.item{border-left:6px solid #c62828;border-radius:10px;padding:10px}
.stars{color:#f6b400;font-weight:700}
.links a{color:#c62828;font-weight:700;text-decoration:none}
</style>
</head>

<body>

<header>
  <h1 id="title">æ–°ç«¹ç±³ç²‰åœ°åœ–</h1>
  <div class="spacer"></div>
  <button id="langBtn">EN</button>
</header>

<div id="map"></div>

<main>
<section class="panel">
<h2>ğŸœ åº—å®¶è©•åˆ†</h2>
<div class="list" id="shopList"></div>
</section>

<section class="panel">
<h2>ğŸ“ æˆ‘è¦è©•åˆ†</h2>
<a href="ã€åœ¨é€™è£¡è²¼ä½ çš„ Google è¡¨å–®é€£çµã€‘" target="_blank">
ğŸ‘‰ é»æˆ‘å‰å¾€ Google è¡¨å–®è©•åˆ†
</a>
</section>
</main>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
let lang="zh";

const shops=[
{id:"dongmen",zh:"æ±é–€ç±³ç²‰æ”¤",en:"Dongmen Market Rice Noodle Soup",lat:24.8046,lng:120.9715,g:"https://www.google.com/maps/search/?api=1&query=æ±é–€ç±³ç²‰æ”¤ æ–°ç«¹"},
{id:"acheng",zh:"é˜¿åŸç±³ç²‰",en:"A-Cheng Rice Noodles",lat:24.8039,lng:120.9659,g:"https://www.google.com/maps/search/?api=1&query=é˜¿åŸç±³ç²‰ æ–°ç«¹"},
{id:"datong",zh:"å¤§åŒç±³ç²‰æ¹¯",en:"Datong Rice Noodle Soup",lat:24.8134,lng:120.9721,g:"https://www.google.com/maps/search/?api=1&query=å¤§åŒç±³ç²‰æ¹¯ æ–°ç«¹"},
{id:"dingpu",zh:"é ‚åŸ”ç±³ç²‰æ¹¯",en:"Dingpu Rice Noodle Soup",lat:24.76091,lng:120.92934,g:"https://www.google.com/maps/place/é ‚åŸ”ç±³ç²‰æ¹¯"}
];

const map=L.map("map").setView([24.8039,120.9698],14);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(map);

shops.forEach(s=>{
const m=L.marker([s.lat,s.lng]).addTo(map);
m.bindPopup(`<b>${lang==="zh"?s.zh:s.en}</b><br><a href="${s.g}" target="_blank">Google Maps</a>`);
m.on("click",()=>{m.openPopup();map.setView([s.lat,s.lng],17);});
});

/* ===== å¾ Google Sheets è®€å–å¹³å‡ ===== */
fetch("ã€åœ¨é€™è£¡è²¼ Google Sheets CSV é€£çµã€‘")
.then(r=>r.text())
.then(t=>{
const rows=t.trim().split("\n").slice(1);
const stat={};

rows.forEach(r=>{
const [id,star]=r.split(",");
if(!stat[id])stat[id]={sum:0,count:0};
stat[id].sum+=Number(star);
stat[id].count++;
});

document.getElementById("shopList").innerHTML=shops.map(s=>{
const d=stat[s.id];
const avg=d?(d.sum/d.count).toFixed(1):"å°šç„¡";
const cnt=d?d.count:0;
return `<div class="item">
<b>${lang==="zh"?s.zh:s.en}</b><br>
<span class="stars">â­ ${avg}</span>ï¼ˆ${cnt} äººï¼‰
</div>`;
}).join("");
});
</script>

</body>
</html>