<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>æ–°ç«¹ç±³ç²‰åœ°åœ– | Hsinchu Rice Noodle Map</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
:root{
  --red:#c62828;
  --bg:#faf7f2;
  --card:#ffffff;
  --star:#f6b400;
}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"PingFang TC","Noto Sans TC","Microsoft JhengHei",sans-serif;
  background:var(--bg);
  color:#222;
}
header{
  background:var(--red);
  color:#fff;
  padding:14px 18px;
  display:flex;
  align-items:center;
}
header h1{margin:0;font-size:1.2rem}
header .spacer{flex:1}
header button{
  background:#fff;
  color:var(--red);
  border:none;
  border-radius:20px;
  padding:6px 14px;
  font-weight:700;
  cursor:pointer;
}
#map{height:60vh}

main{
  max-width:1100px;
  margin:auto;
  padding:16px;
}
.panel{
  background:var(--card);
  border-radius:16px;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
  padding:16px;
  margin-bottom:16px;
}
.panel h2{margin-top:0}
.list{
  display:grid;
  grid-template-columns:1fr;
  gap:12px;
}
@media(min-width:760px){
  .list{grid-template-columns:1fr 1fr}
}
.item{
  border-left:6px solid var(--red);
  border-radius:12px;
  padding:12px;
}
.stars{color:var(--star);font-weight:700;font-size:1.05rem}
.links a{
  color:var(--red);
  font-weight:700;
  text-decoration:none;
}
.footer{
  text-align:center;
  font-size:.85rem;
  color:#666;
  margin-bottom:20px;
}
</style>
</head>

<body>

<header>
  <h1 id="title">æ–°ç«¹ç±³ç²‰åœ°åœ–</h1>
  <div class="spacer"></div>
  <button id="langBtn">EN</button>
</header>

<div id="map"></div>

<main>

<section class="panel">
<h2 id="rateTitle">ğŸœ åº—å®¶è©•åˆ†</h2>
<div class="list" id="shopList"></div>
</section>

<section class="panel">
<h2 id="formTitle">ğŸ“ æˆ‘è¦è©•åˆ†</h2>
<a id="formLink" href="ã€ä½ çš„ Google è¡¨å–®é€£çµã€‘" target="_blank">
ğŸ‘‰ å‰å¾€ Google è¡¨å–®å¡«å¯«è©•åˆ†
</a>
</section>

</main>

<div class="footer">
Â© Hsinchu Rice Noodle Mapï½œè³‡æ–™æŒçºŒæ›´æ–°ä¸­
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
let lang="zh";

const shops=[
/* æ–°ç«¹ç«è»Šç«™ */
{id:"dongmen",zh:"æ±é–€ç±³ç²‰æ”¤",en:"Dongmen Market Rice Noodles",lat:24.8046,lng:120.9715},
{id:"acheng",zh:"é˜¿åŸç±³ç²‰",en:"A-Cheng Rice Noodles",lat:24.8039,lng:120.9659},
{id:"datong",zh:"å¤§åŒç±³ç²‰æ¹¯",en:"Datong Rice Noodle Soup",lat:24.8134,lng:120.9721},

/* åŒ—æ–°ç«¹ç«™ */
{id:"linji",zh:"æ—è¨˜ç±³ç²‰æ¹¯",en:"Lin's Rice Noodles",lat:24.8139,lng:120.9866},
{id:"zhubei_old",zh:"è€ç‰Œç±³ç²‰æ¹¯",en:"Old Brand Rice Noodles",lat:24.8155,lng:120.9851},

/* é¦™å±±ç«™ */
{id:"xiangshan_old",zh:"é¦™å±±è€åº—ç±³ç²‰æ¹¯",en:"Xiangshan Old Rice Noodles",lat:24.7646,lng:120.9104},

/* ç«¹åŒ—ç«™ */
{id:"zhubei_cheng",zh:"æ­£å®—ç«¹åŒ—ç±³ç²‰æ¹¯",en:"Zhubei Classic Rice Noodles",lat:24.8388,lng:121.0094},
{id:"zhubei_liu",zh:"åŠ‰å®¶ç±³ç²‰æ¹¯",en:"Liuâ€™s Rice Noodles",lat:24.8374,lng:121.0112}
];

/* ===== åœ°åœ–åˆå§‹åŒ– ===== */
const map = L.map("map", {
  zoomControl: true,
  preferCanvas: true
}).setView([24.805, 120.97], 15);

/* ===== åœ°åœ–ç“¦ç‰‡ï¼ˆä¸€å®šè¦åœ¨ marker å‰é¢ï¼‰ ===== */
L.tileLayer(
  "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
  {
    maxZoom: 19,
    detectRetina: true, // æ‰‹æ©Ÿæœƒæ›´æ¸…æ¥š
    attribution: "Â© OpenStreetMap"
  }
).addTo(map);
  const popupContent = `
    <b>${lang==="zh"?s.zh:s.en}</b><br>
    <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(s.zh)}" target="_blank">
      Google Maps
    </a>
  `;

  m.bindPopup(popupContent, { closeButton: true });

  m.on("click", () => {
    map.flyTo([s.lat, s.lng], 17, {
      animate: true,
      duration: 0.6
    });
    m.openPopup();
  });
});

/* ===== å¾ Google Sheets è®€å–è©•åˆ† ===== */
fetch("ã€ä½ çš„ Google Sheets CSV é€£çµã€‘")
.then(r=>r.text())
.then(t=>{
  const rows=t.trim().split("\n").slice(1);
  const stat={};

  rows.forEach(r=>{
    const [id,star]=r.split(",");
    if(!stat[id])stat[id]={sum:0,count:0};
    stat[id].sum+=Number(star);
    stat[id].count++;
  });

  document.getElementById("shopList").innerHTML=shops.map(s=>{
    const d=stat[s.id];
    const avg=d?(d.sum/d.count).toFixed(1):"â€”";
    const cnt=d?d.count:0;
    return `
      <div class="item">
        <b>${lang==="zh"?s.zh:s.en}</b><br>
        <span class="stars">â­ ${avg}</span>ï¼ˆ${cnt}ï¼‰
      </div>
    `;
  }).join("");
});
</script>

</body>
</html>